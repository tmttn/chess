import{w as G,n as d}from"./B7_9F9Xb.js";import{b as W}from"./BWKNUDvW.js";class y{static __wrap(t){t=t>>>0;const r=Object.create(y.prototype);return r.__wbg_ptr=t,C.register(r,r.__wbg_ptr,r),r}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,C.unregister(this),t}free(){const t=this.__destroy_into_raw();s.__wbg_game_free(t,0)}static fromFen(t){try{const n=s.__wbindgen_add_to_stack_pointer(-16),o=A(t,s.__wbindgen_export,s.__wbindgen_export2),c=m;s.game_fromFen(n,o,c);var r=_().getInt32(n+0,!0),i=_().getInt32(n+4,!0),a=_().getInt32(n+8,!0);if(a)throw R(i);return y.__wrap(r)}finally{s.__wbindgen_add_to_stack_pointer(16)}}isCheck(){return s.game_isCheck(this.__wbg_ptr)!==0}isGameOver(){return s.game_isGameOver(this.__wbg_ptr)!==0}legalMoves(){try{const a=s.__wbindgen_add_to_stack_pointer(-16);s.game_legalMoves(a,this.__wbg_ptr);var t=_().getInt32(a+0,!0),r=_().getInt32(a+4,!0),i=ee(t,r).slice();return s.__wbindgen_export3(t,r*4,4),i}finally{s.__wbindgen_add_to_stack_pointer(16)}}makeMove(t){try{const a=s.__wbindgen_add_to_stack_pointer(-16),n=A(t,s.__wbindgen_export,s.__wbindgen_export2),o=m;s.game_makeMove(a,this.__wbg_ptr,n,o);var r=_().getInt32(a+0,!0),i=_().getInt32(a+4,!0);if(i)throw R(r)}finally{s.__wbindgen_add_to_stack_pointer(16)}}moveToSan(t){let r,i;try{const p=s.__wbindgen_add_to_stack_pointer(-16),b=A(t,s.__wbindgen_export,s.__wbindgen_export2),T=m;s.game_moveToSan(p,this.__wbg_ptr,b,T);var a=_().getInt32(p+0,!0),n=_().getInt32(p+4,!0),o=_().getInt32(p+8,!0),c=_().getInt32(p+12,!0),u=a,h=n;if(c)throw u=0,h=0,R(o);return r=u,i=h,g(u,h)}finally{s.__wbindgen_add_to_stack_pointer(16),s.__wbindgen_export3(r,i,1)}}constructor(){const t=s.game_new();return this.__wbg_ptr=t>>>0,C.register(this,this.__wbg_ptr,this),this}pieceAt(t){try{const a=s.__wbindgen_add_to_stack_pointer(-16),n=A(t,s.__wbindgen_export,s.__wbindgen_export2),o=m;s.game_pieceAt(a,this.__wbg_ptr,n,o);var r=_().getInt32(a+0,!0),i=_().getInt32(a+4,!0);let c;return r!==0&&(c=g(r,i).slice(),s.__wbindgen_export3(r,i*1,1)),c}finally{s.__wbindgen_add_to_stack_pointer(16)}}reset(){s.game_reset(this.__wbg_ptr)}result(){try{const i=s.__wbindgen_add_to_stack_pointer(-16);s.game_result(i,this.__wbg_ptr);var t=_().getInt32(i+0,!0),r=_().getInt32(i+4,!0);let a;return t!==0&&(a=g(t,r).slice(),s.__wbindgen_export3(t,r*1,1)),a}finally{s.__wbindgen_add_to_stack_pointer(16)}}sideToMove(){let t,r;try{const n=s.__wbindgen_add_to_stack_pointer(-16);s.game_sideToMove(n,this.__wbg_ptr);var i=_().getInt32(n+0,!0),a=_().getInt32(n+4,!0);return t=i,r=a,g(i,a)}finally{s.__wbindgen_add_to_stack_pointer(16),s.__wbindgen_export3(t,r,1)}}toFen(){let t,r;try{const n=s.__wbindgen_add_to_stack_pointer(-16);s.game_toFen(n,this.__wbg_ptr);var i=_().getInt32(n+0,!0),a=_().getInt32(n+4,!0);return t=i,r=a,g(i,a)}finally{s.__wbindgen_add_to_stack_pointer(16),s.__wbindgen_export3(t,r,1)}}}Symbol.dispose&&(y.prototype[Symbol.dispose]=y.prototype.free);function Z(){return{__proto__:null,"./chess_wasm_bg.js":{__proto__:null,__wbg_Error_8c4e43fe74559d73:function(t,r){const i=Error(g(t,r));return N(i)},__wbg___wbindgen_throw_be289d5034ed271b:function(t,r){throw new Error(g(t,r))},__wbindgen_cast_0000000000000001:function(t,r){const i=g(t,r);return N(i)}}}}const C=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>s.__wbg_game_free(e>>>0,1));function N(e){k===l.length&&l.push(l.length+1);const t=k;return k=l[t],l[t]=e,t}function $(e){e<132||(l[e]=k,k=e)}function ee(e,t){e=e>>>0;const r=_(),i=[];for(let a=e;a<e+4*t;a+=4)i.push(R(r.getUint32(a,!0)));return i}let w=null;function _(){return(w===null||w.buffer.detached===!0||w.buffer.detached===void 0&&w.buffer!==s.memory.buffer)&&(w=new DataView(s.memory.buffer)),w}function g(e,t){return e=e>>>0,re(e,t)}let M=null;function F(){return(M===null||M.byteLength===0)&&(M=new Uint8Array(s.memory.buffer)),M}function te(e){return l[e]}let l=new Array(128).fill(void 0);l.push(void 0,null,!0,!1);let k=l.length;function A(e,t,r){if(r===void 0){const c=x.encode(e),u=t(c.length,1)>>>0;return F().subarray(u,u+c.length).set(c),m=c.length,u}let i=e.length,a=t(i,1)>>>0;const n=F();let o=0;for(;o<i;o++){const c=e.charCodeAt(o);if(c>127)break;n[a+o]=c}if(o!==i){o!==0&&(e=e.slice(o)),a=r(a,i,i=o+e.length*3,1)>>>0;const c=F().subarray(a+o,a+i),u=x.encodeInto(e,c);o+=u.written,a=r(a,i,o,1)>>>0}return m=o,a}function R(e){const t=te(e);return $(e),t}let E=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});E.decode();const ne=2146435072;let P=0;function re(e,t){return P+=t,P>=ne&&(E=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}),E.decode(),P=t),E.decode(F().subarray(e,e+t))}const x=new TextEncoder;"encodeInto"in x||(x.encodeInto=function(e,t){const r=x.encode(e);return t.set(r),{read:e.length,written:r.length}});let m=0,s;function oe(e,t){return s=e.exports,w=null,M=null,s.__wbindgen_start(),s}async function ie(e,t){if(typeof Response=="function"&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(e,t)}catch(a){if(e.ok&&r(e.type)&&e.headers.get("Content-Type")!=="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",a);else throw a}const i=await e.arrayBuffer();return await WebAssembly.instantiate(i,t)}else{const i=await WebAssembly.instantiate(e,t);return i instanceof WebAssembly.Instance?{instance:i,module:e}:i}function r(i){switch(i){case"basic":case"cors":case"default":return!0}return!1}}async function se(e){if(s!==void 0)return s;e!==void 0&&(Object.getPrototypeOf(e)===Object.prototype?{module_or_path:e}=e:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),e===void 0&&(e=new URL(""+new URL("../assets/chess_wasm_bg.cciepV4U.wasm",import.meta.url).href,import.meta.url));const t=Z();(typeof e=="string"||typeof Request=="function"&&e instanceof Request||typeof URL=="function"&&e instanceof URL)&&(e=fetch(e));const{instance:r,module:i}=await ie(await e,t);return oe(r)}const ae=G(!1);let U=!1,S=null;async function pe(){if(W&&!U)try{await se("/chess_wasm_bg.wasm"),S=y,U=!0,ae.set(!0),console.log("WASM initialized successfully")}catch(e){throw console.error("Failed to initialize WASM:",e),e}}function q(e){const t=e.slice(0,2),r=e.slice(2,4),i=e.length>4?e[4]:void 0;return{uci:e,from:t,to:r,promotion:i}}function ce(e){const t=e.toLowerCase(),r=e===t?"black":"white";return{type:{p:"p",n:"n",b:"b",r:"r",q:"q",k:"k"}[t],color:r}}function j(){if(!S)throw new Error("WASM not initialized");return new S}function V(e){if(!S)throw new Error("WASM not initialized");try{return S.fromFen(e)}catch{return null}}function _e(e){return e.legalMoves().map(q)}function ue(e,t){try{return e.makeMove(t),!0}catch{return!1}}function de(e,t){try{return e.moveToSan(t)}catch{return null}}function z(e){const t=new Map,r="abcdefgh",i="12345678";for(const a of r)for(const n of i){const o=a+n,c=e.pieceAt(o);c&&t.set(o,ce(c))}return t}const I="https://lichess1.org/assets/sound/standard",K={move:`${I}/Move.mp3`,capture:`${I}/Capture.mp3`,check:`${I}/Check.mp3`,gameStart:`${I}/GenericNotify.mp3`,gameEnd:`${I}/Victory.mp3`},Q="chess-devtools-muted",Y=W?localStorage.getItem(Q)==="true":!1,B=G(Y);B.subscribe(e=>{W&&localStorage.setItem(Q,String(e))});function be(){B.update(e=>!e)}const D=new Map;let J=Y;B.subscribe(e=>{J=e});function X(e){let t=D.get(e);return t||(t=new Audio(K[e]),t.volume=.5,D.set(e,t)),t}function v(e){if(J)return;const t=X(e);t.currentTime=0,t.play().catch(()=>{})}function fe(){Object.keys(K).forEach(e=>{X(e)})}const H="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",O={game:null,fen:H,legalMoves:[],board:new Map,liveBoard:new Map,moveHistory:[],viewIndex:-1,isCheck:!1,isGameOver:!1,result:null,sideToMove:"white"};function le(){const{subscribe:e,set:t,update:r}=G(O);function i(n){const o=z(n);return{fen:n.toFen(),legalMoves:_e(n),board:o,liveBoard:o,isCheck:n.isCheck(),isGameOver:n.isGameOver(),result:n.result()??null,sideToMove:n.sideToMove()}}function a(n){const o=V(n);return o?z(o):new Map}return{subscribe:e,init(){fe();const n=j();t({...O,game:n,...i(n)}),v("gameStart")},makeMove(n){r(o=>{if(!o.game)return o;const c=q(n),u=o.liveBoard.has(c.to),h=de(o.game,n)??n;if(ue(o.game,n)){const b=i(o.game);b.isGameOver?v("gameEnd"):b.isCheck?v("check"):v(u?"capture":"move");const T=[...o.moveHistory,{uci:n,san:h,fen:b.fen}];return{...o,...b,moveHistory:T,viewIndex:T.length-1}}return o})},viewPrev(){r(n=>{if(n.viewIndex<0)return n;const o=n.viewIndex-1,c=o>=0?n.moveHistory[o].fen:H;return{...n,board:a(c),viewIndex:o}})},viewNext(){r(n=>{if(n.viewIndex>=n.moveHistory.length-1)return n;const o=n.viewIndex+1,c=n.moveHistory[o].fen;return{...n,board:a(c),viewIndex:o}})},goToMove(n){r(o=>{if(n<-1||n>=o.moveHistory.length)return o;const c=n>=0?o.moveHistory[n].fen:H;return{...o,board:a(c),viewIndex:n}})},goToStart(){r(n=>({...n,board:a(H),viewIndex:-1}))},goToLive(){r(n=>({...n,board:n.liveBoard,viewIndex:n.moveHistory.length-1}))},newGame(){const n=j();t({...O,game:n,...i(n)}),v("gameStart")},loadFen(n){const o=V(n);return o?(t({...O,game:o,...i(o)}),!0):!1},attachSearchInfoToLastMove(n){r(o=>{if(o.moveHistory.length===0)return o;const c=[...o.moveHistory],u=c.length-1;return c[u]={...c[u],searchInfo:n},{...o,moveHistory:c}})}}}const f=le(),L="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",ve=d(f,e=>e.board),me=d(f,e=>e.legalMoves),ye=d(f,e=>e.sideToMove),he=d(f,e=>e.isCheck),Ie=d(f,e=>e.isGameOver),Me=d(f,e=>e.viewIndex),ke=d(f,e=>e.viewIndex<e.moveHistory.length-1),xe=d(f,e=>e.moveHistory.length),Se=d(f,e=>e.viewIndex>=0?e.moveHistory[e.viewIndex]?.fen??L:L),Te=d(f,e=>e.fen),Ae=d(f,e=>e.viewIndex>=0?e.moveHistory[e.viewIndex]?.searchInfo??null:null);export{he as a,ve as b,B as c,ke as d,Ie as e,V as f,f as g,_e as h,pe as i,Se as j,Te as k,me as l,xe as m,Ae as n,ye as s,be as t,Me as v,ae as w};
